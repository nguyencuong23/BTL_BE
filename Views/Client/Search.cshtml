@model IEnumerable<QuanLyThuVienTruongHoc.Models.Library.Book>

@{
    ViewData["Title"] = "Tra cứu Tài liệu";
}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="~/css/search.css" asp-append-version="true" />

<section class="doc-lookup-hero">
    <div class="container text-center">
        <h1 class="hero-title">KHO TÀI LIỆU SỐ & THƯ VIỆN</h1>
        <p class="hero-subtitle">Tra cứu vị trí sách và tài liệu trong toàn bộ hệ thống</p>

        <div class="search-box-wrapper animate-slide-down">
            <form method="get" asp-action="Search">
                <div class="search-input-group">
                    <div class="input-divider"></div>

                    <input type="text" name="search" class="search-input" placeholder="Nhập tên sách, tác giả để tìm kiếm" value="@Context.Request.Query["search"]">

                    <button type="submit" class="btn-search-doc">
                        <i class="fa-solid fa-magnifying-glass"></i> Tìm kiếm
                    </button>
                </div>
            </form>
        </div>
    </div>
</section>

<div class="container py-5">
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success">@TempData["Success"]</div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger">@TempData["Error"]</div>
    }

    @if (!Model.Any())
    {
        <div id="emptyState" class="text-center py-5">
            <img src="https://cdn-icons-png.flaticon.com/512/6195/6195678.png" width="100" style="opacity: 0.6; margin-bottom: 20px;">
            <h5>Không tìm thấy tài liệu nào</h5>
            <p class="text-muted">Vui lòng thử lại với từ khóa khác.</p>
        </div>
    }
    else
    {
        <div id="resultGrid" class="row g-4">
            @foreach (var book in Model)
            {
                var isAvailable = book.Quantity > 0;
                var locationDisplay = !string.IsNullOrEmpty(book.Location) ? book.Location : "Đang cập nhật";
                var imgUrl = !string.IsNullOrEmpty(book.ImagePath) ? book.ImagePath : "https://via.placeholder.com/300x450?text=No+Image";

                <div class="col-lg-3 col-md-4 col-sm-6 animate-fade-in">
                    <div class="book-card" onclick="openDetailModal('@book.BookId')">
                        <div class="book-cover-wrapper">
                            @if (isAvailable)
                            {
                                <span class="book-badge badge-avail"><i class="fa-solid fa-check"></i> Sẵn sàng</span>
                            }
                            else
                            {
                                <span class="book-badge badge-out"><i class="fa-solid fa-xmark"></i> Hết sách</span>
                            }
                            <img src="@imgUrl" class="book-cover" alt="@book.Title" loading="lazy">
                            <div class="book-overlay">
                                <span>Xem chi tiết</span>
                            </div>
                        </div>
                        <div class="book-info">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <small class="text-muted book-cat">@book.Category?.Name</small>
                                <span class="location-badge"><i class="fa-solid fa-location-dot"></i> @locationDisplay</span>
                            </div>
                            <h3 class="book-title" title="@book.Title">@book.Title</h3>
                            <p class="book-author"><i class="fa-solid fa-pen-nib"></i> @book.Author</p>
                        </div>
                    </div>

                    <!-- Hidden Info for Modal -->
                    <div id="modal-data-@book.BookId" class="d-none">
                        <span class="data-title">@book.Title</span>
                        <span class="data-author">@book.Author</span>
                        <span class="data-category">@book.Category?.Name</span>
                        <span class="data-location">@locationDisplay</span>
                        <span class="data-quantity">@book.Quantity</span>
                        <span class="data-image">@imgUrl</span>
                        <span class="data-publisher">@book.Publisher</span>
                        <span class="data-year">@book.PublishYear</span>
                    </div>
                </div>
            }
        </div>
    }
</div>

<!-- Modal Structure -->
<div id="modal-overlay" class="modal-overlay">
    <div class="glass-modal">
        <span class="close-btn" onclick="closeModal()">&times;</span>
        <div id="detail-content">
            <!-- Content filled by JS -->
        </div>
    </div>
</div>

<!-- Hidden Configuration for JS -->
<div id="app-config" style="display:none;">
    <div id="csrf-container">
        @Html.AntiForgeryToken()
    </div>
    <input type="hidden" id="default-due-date" value="@DateTime.Now.AddDays(14).ToString("yyyy-MM-dd")" />
</div>

<script src="~/js/search.js" asp-append-version="true"></script>
