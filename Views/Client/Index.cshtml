@{
    ViewData["Title"] = "Trang chủ";
}

<link href="~/css/client-index.css" rel="stylesheet">

<!-- HERO -->
<section class="hero">
    <div class="container">
        <div class="row">
            <div class="col-lg-7">
                <h1 class="fw-bold mb-4">
                    Kết nối <span>tri thức</span><br />
                    tại Thư viện Đại học Đại Nam
                </h1>

                <div class="search-box">
                    <input class="form-control" placeholder="Nhập tên sách, tác giả...">
                    <button class="btn btn-warning px-4 fw-semibold">Tìm</button>
                </div>
            </div>
        </div>
    </div>
</section>
<section class="book-section">
    <div class="container">
        <h3 class="fw-bold text-center mb-4">
            Kho tài liệu <br />
        </h3>

        <div id="bookCarousel" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner" id="book-carousel-inner">
                <div class="text-center py-5">
                    <div class="spinner-border text-warning" role="status">
                        <span class="visually-hidden">Đang tải...</span>
                    </div>
                </div>
            </div>

            <button class="carousel-control-prev" type="button" data-bs-target="#bookCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon bg-dark rounded-circle p-3"></span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#bookCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon bg-dark rounded-circle p-3"></span>
            </button>
        </div>
    </div>
</section>

<!-- FEATURE -->
<section class="py-5">
    <div class="container">
        <div class="row g-4">
            <div class="col-md-4">
                <a asp-controller="Client" asp-action="Payback" class="d-block text-decoration-none">
                    <div class="feature-img feature-img-bg-1">
                        <div class="feature-overlay">
                            <h5>Hướng dẫn mượn sách</h5>
                            <p>Quy trình mượn – trả hiện đại</p>
                        </div>
                    </div>
                </a>
            </div>

            <div class="col-md-4">
                <a asp-controller="Client" asp-action="Tracuu" class="d-block text-decoration-none">
                    <div class="feature-img feature-img-bg-2">
                        <div class="feature-overlay">
                            <h5>Tra cứu tài liệu</h5>
                            <p>Tìm kiếm học liệu nhanh</p>
                        </div>
                    </div>
                </a>
            </div>

            <div class="col-md-4">
                <a asp-controller="Client" asp-action="Privacy" class="d-block text-decoration-none">
                    <div class="feature-img feature-img-bg-3">
                        <div class="feature-overlay">
                            <h5>Danh mục chuyên ngành</h5>
                            <p>Theo khoa & lĩnh vực</p>
                        </div>
                    </div>
                </a>
            </div>
        </div>
    </div>
</section>

<!-- CATEGORY -->
<section class="pb-5">
    <div class="container">
        <h4 class="fw-bold mb-4">Không gian học tập hiện đại</h4>
        <div class="row g-4">
            <div class="col-md-4">
                <div class="category category-bg-1">
                    <span>Sứ mệnh & Vai trò</span>
                </div>
            </div>

            <div class="col-md-4">
                <div class="category category-bg-2">
                    <span>Không gian chia sẻ</span>
                </div>
            </div>

            <div class="col-md-4">
                <div class="category category-bg-3">
                    <span>Đào tạo & Nghiên cứu</span>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- PARTNER -->
<section class="py-5 bg-white">
    <div class="container">
        <h4 class="fw-bold text-center mb-4">Đối tác liên kết</h4>
        <div class="row g-4">

            <div class="col-6 col-md-4">
                <a href="https://fibocapital.vn" target="_blank">
                    <div class="partner-box partner-box-bg-1">
                        <span>Fibo Capital Việt Nam</span>
                    </div>
                </a>
            </div>

            <div class="col-6 col-md-4">
                <a href="https://www.manulife.com.vn" target="_blank">
                    <div class="partner-box partner-box-bg-2">
                        <span>Manulife Việt Nam</span>
                    </div>
                </a>
            </div>

            <div class="col-6 col-md-4">
                <a href="https://xuanhoa.vn" target="_blank">
                    <div class="partner-box partner-box-bg-3">
                        <span>Xuân Hòa Việt Nam</span>
                    </div>
                </a>
            </div>

        </div>
    </div>
</section>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        loadCarouselBooks();
    });

    async function loadCarouselBooks() {
        const carouselContainer = document.getElementById('book-carousel-inner');
        const API_URL = '/api/library/books';

        try {
            const response = await fetch(API_URL);
            if (!response.ok) throw new Error("Lỗi tải dữ liệu");

            const books = await response.json();

            if (books.length === 0) {
                carouselContainer.innerHTML = '<div class="text-center">Chưa có sách nào.</div>';
                return;
            }

            carouselContainer.innerHTML = '';
            const itemsPerSlide = 4;

            for (let i = 0; i < books.length; i += itemsPerSlide) {
                const chunk = books.slice(i, i + itemsPerSlide);
                const isActive = i === 0 ? 'active' : '';
                let slideHtml = `
                    <div class="carousel-item ${isActive}">
                        <div class="row g-4 justify-content-center">
                `;

                chunk.forEach(book => {
                    const imgUrl = book.image && book.image !== ""
                                   ? book.image
                                   : "https://via.placeholder.com/300x450?text=No+Image";



                    slideHtml += `
                        <div class="col-6 col-md-3">
                            <a href="#" onclick="openBorrowModal('${book.id}', '${book.title}')" class="book-card text-decoration-none text-dark d-block">
                                <img src="${imgUrl}" style="height: 300px; object-fit: cover; width: 100%; border-radius: 8px;">
                                <h6 class="mt-2 fw-bold text-truncate" title="${book.title}">${book.title}</h6>
                                <span class="d-block text-secondary small text-truncate">${book.author}</span>
                            </a>
                        </div>
                    `;
                });

                slideHtml += `
                        </div>
                    </div>
                `;

                carouselContainer.innerHTML += slideHtml;
            }

        } catch (error) {
            console.error(error);
            carouselContainer.innerHTML = '<div class="text-center text-danger">Không thể tải danh sách sách.</div>';
        }
    }
</script>
